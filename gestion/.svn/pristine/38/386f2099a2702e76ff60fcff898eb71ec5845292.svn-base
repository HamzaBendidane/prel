<?php
 
/**
 * Implementation of hook_block_info().
 */
function ecofolio_footer_block_info(){
  $blocks['ecofolio_footer_full'] = array('info'=>'Ecofolio full footer');
  return $blocks;
}

/**
 * Implementation of hook_block_view().
 */
function ecofolio_footer_block_view($delta=''){
  global $base_url, $user, $node;
  $block = array();
  switch($delta){
    case 'ecofolio_footer_full':
      $block = ecofolio_footer_bloc_full();
      break;
  }
  return $block;
}




function ecofolio_footer_bloc_full() {
  $logo = theme_get_setting('logo'); 
  $sitename = variable_get('site_name', "Ecofolio"); 
  $url_base = url("",array("absolute"=>true));

  $top_menu = '';
  $top_menu_tree = menu_tree_all_data('menu-top-menu',null,1);
  menu_tree_add_active_path($top_menu_tree);
  foreach($top_menu_tree as $tmt) {
    if(($tmt['link']['hidden']==0)) {
      if($tmt['link']['in_active_trail']==1) $top_menu .= '<li class="active"><a href="'.url($tmt['link']['href'],array("absolute"=>true)).'">'.$tmt['link']['title'].'</a></li>';
      else $top_menu .= '<li><a href="'.url($tmt['link']['href'],array("absolute"=>true)).'">'.$tmt['link']['title'].'</a></li>';
    }
  }

  $view = views_get_view('social_networks_footer');
  $follow_us = $view->render('block');

  $block = module_invoke('block', 'block_view', '1');
  $copyright = render($block['content']);

  $main_menu = '';
  $main_menu_tree = menu_tree_all_data('menu-footer-menu',null,2);
  menu_tree_add_active_path($main_menu_tree);
  foreach($main_menu_tree as $tmt) {
    if(($tmt['link']['hidden']==0)) {
      if($tmt['link']['mlid']!=3017) {
        if($tmt['link']['in_active_trail']==1) $main_menu .= '<li class="active"><a href="'.url($tmt['link']['href'],array("absolute"=>true)).'">'.$tmt['link']['title'].'</a>';
        else $main_menu .= '<li><a href="'.url($tmt['link']['href'],array("absolute"=>true)).'">'.$tmt['link']['title'].'</a>';
      } else {
        if($tmt['link']['in_active_trail']==1) $main_menu .= '<li class="active notoptitle">';
        else $main_menu .= '<li class="notoptitle">';
      }
      if(isset($tmt['below'])) {
        $main_menu .= '<ul>';
        foreach($tmt['below'] as $tmt2) {
          if(($tmt2['link']['hidden']==0)) {
            if($tmt2['link']['in_active_trail']==1) $main_menu .= '<li class="active"><a href="'.url($tmt2['link']['href'],array("absolute"=>true)).'">'.$tmt2['link']['title'].'</a>';
            else $main_menu .= '<li><a href="'.url($tmt2['link']['href'],array("absolute"=>true)).'">'.$tmt2['link']['title'].'</a>';
          }
        }
        $main_menu .= '</ul>';
      }
      $main_menu .= '</li>';
    }
  }


  $contenu = <<< END
  <div class="footer_full">
    <div class="encart_footer">
      <div class="logo"><a href="{$url_base}"><img src="{$logo}" alt="{$sitename}" /></a></div>
      <div class="menu_top_right">
        <ul>
          {$top_menu}
        </ul>
      </div>
      <div class="follow_us">
        {$follow_us}
      </div>
    </div>
    <div class="main_menu">
      <ul>
        {$main_menu}
      </ul>
    </div>
    <div class="copyright">{$copyright}</div>
    <div class="go_up">
      <a href=""></a>
    </div>
  </div>
END;
  return array("subject"=>"", "content"=>$contenu);
}


?>