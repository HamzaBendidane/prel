<?php


function ecofolio_manage_mediatheque_install() {
  $field = array(
      'type' => 'int',
      'not null' => TRUE,
      'default' => 0,
      'description' => 'Boolean to know if the user accepted the CGU.',
  );
  
  $index = array(
      'indexes' => array(
          'cgu_accepted' => array('cgu_accepted')
      ),
  );

  db_add_field('users', 'cgu_accepted', $field, $index);

  drupal_install_schema('ecofolio_manage_mediatheque');
}

/**
 * Implements hook_schema().
 */
function ecofolio_manage_mediatheque_schema() {
  $schema['media_cpu'] = array(
    'description'  => 'MÃ©dia CPU',
    'fields'       => array(
      'user_id'    => array(
        'type'        => 'int',
        'unsigned'    => TRUE,
        'not null'    => TRUE,
        'description' => '',
        'default' => 0,
      ),
      'cpu_id' => array(
        'type' => 'int',
        'unsigned' => TRUE,
        'not null' => TRUE,
        'description' => '',
        'default' => 0,
      ),
      'user_firstname' => array(
        'type' => 'varchar',
        'length' => 255,
        'not null' => FALSE,
        'default' => NULL
      ),
      'user_lastname' => array(
        'type' => 'varchar',
        'length' => 255,
        'not null' => FALSE,
        'default' => NULL
      ),
      'user_email' => array(
        'type' => 'varchar',
        'length' => 255,
        'not null' => FALSE,
        'default' => NULL
      ),
    ),
    'primary key' => array('user_id', 'cpu_id'),
  );
  return $schema;
}

function ecofolio_manage_mediatheque_schema_alter(&$schema) {
  $schema['users']['fields']['cgu_accepted'] = array(
      'type' => 'int',
      'not null' => TRUE,
      'default' => 0,
      'description' => 'Boolean to know if the user accepted the CGU.',
  );
}

function ecofolio_manage_mediatheque_uninstall() {
  db_drop_field('users', 'cgu_accepted');
  drupal_uninstall_schema('ecofolio_manage_mediatheque');
}
