<?php
 
/**
 * Implementation of hook_block_info().
 */
function ecofolio_pageinterne_block_info(){
  $blocks['ecofolio_pageinterne_full'] = array('info'=>'Ecofolio blocs page interne');
  return $blocks;
}

/**
 * Implementation of hook_block_view().
 */
function ecofolio_pageinterne_block_view($delta=''){
  global $base_url, $user, $node;
  $block = array();
  switch($delta){
    case 'ecofolio_pageinterne_full':
      $block = ecofolio_pageinterne_full();
      break;

  }
  return $block;
}




function ecofolio_pageinterne_full() {
  if(arg(0)=='node' && is_numeric(arg(1))) $node_tmp = node_load(arg(1));
  if(isset($node_tmp) && ($node_tmp->type=="page")) {
    $contenu = <<< END
  <div class="footer_page">
END;
    $contenu = '';
    //field_basicpage_brg
    $left_node = node_load($node_tmp->field_basicpage_brg['und'][0]['nid']);
    $img = image_style_url("promo_left", $left_node->field_bloc_rem_image['und'][0]['uri']);
    $link = url('node/'.$left_node->field_bloc_rem_link['und'][0]['nid']);
    $contenu .= <<< END
<div class="promo_left">
  <a href="{$link}">
    <img src="{$img}" />
    <div class="encart">
      <p>{$left_node->field_bloc_rem_teaser['und'][0]['value']}<span class="more">+</span></p>
    </div>
  </a>
</div>
END;
    
    //field_basicpage_brd
    $right_node = node_load($node_tmp->field_basicpage_brd['und'][0]['nid']);
    //print_r($right_node);
    if(isset($right_node->field_bloc_dossier_link_int['und'])) $link = url('node/'.$right_node->field_bloc_dossier_link_int['und'][0]['nid']);
    //elseif(isset($right_node->field_bloc_img_link_ext['und'])) $link = $right_node->field_bloc_img_link_ext['und'][0]['url'];
    else $link = '';
    //print_r($right_node);
    $img = image_style_url("480-402", $right_node->field_bloc_dossier_image['und'][0]['uri']);
    $contenu .= <<< END
<div class="dossier">
  <a href="{$link}">
    <div class="top">
      <h3>{$right_node->field_bloc_dossier_title['und'][0]['value']}</h3>
      <h2>{$right_node->field_bloc_dossier_subtitle['und'][0]['value']}</h2>
      <p class="accroche">{$right_node->field_bloc_dossier_teaser['und'][0]['value']}</p>
    </div>
    <img src="{$img}" />
    <div class="encart"><div class="decouvrir"><span>Découvrir</span></div></div>
  </a>
</div>
END;

    $contenu .= <<< END
</div>
END;


  }elseif(isset($node_tmp) && ($node_tmp->type=="webform")) {
    $contenu = <<< END
  <div class="footer_page">
END;
    $contenu = '';
    //field_basicpage_brg
    $left_node = node_load($node_tmp->field_webform_brg['und'][0]['nid']);
    $img = image_style_url("promo_left", $left_node->field_bloc_rem_image['und'][0]['uri']);
    $link = url('node/'.$left_node->field_bloc_rem_link['und'][0]['nid']);
    $contenu .= <<< END
<div class="promo_left">
  <a href="{$link}">
    <img src="{$img}" />
    <div class="encart">
      <p>{$left_node->field_bloc_rem_teaser['und'][0]['value']}<span class="more">+</span></p>
    </div>
  </a>
</div>
END;
    
    //field_basicpage_brd
    $right_node = node_load($node_tmp->field_webform_brd['und'][0]['nid']);
    if(isset($right_node->field_bloc_img_link_int['und'])) $link = url('node/'.$right_node->field_bloc_img_link_int['und'][0]['nid']);
    elseif(isset($right_node->field_bloc_img_link_ext['und'])) $link = $right_node->field_bloc_img_link_ext['und'][0]['url'];
    else $link = '';
    $img = image_style_url("hp_top_right", $right_node->field_bloc_dossier_image['und'][0]['uri']);
    //print_r($right_node);
    $contenu .= <<< END
<div class="dossier">
  <div class="top">
    <h3>{$right_node->field_bloc_dossier_title['und'][0]['value']}</h3>
    <h2>{$right_node->field_bloc_dossier_subtitle['und'][0]['value']}</h2>
    <p class="accroche">{$right_node->field_bloc_dossier_teaser['und'][0]['value']}</p>
  </div>
  <img src="{$img}" />
  <div class="encart"><a href="{$link}" class="decouvrir"><span>Découvrir</span></a></div>
</div>
END;

    $contenu .= <<< END
</div>
END;


  } else $contenu = '';
  return array("subject"=>"", "content"=>$contenu);
}

?>