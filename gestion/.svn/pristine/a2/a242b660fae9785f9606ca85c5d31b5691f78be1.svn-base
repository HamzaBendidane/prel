<?php

/**
 * 
 *Validation générale du formulaire
 */
function dgf_relance_standard_validate($form, &$form_state) {
  if ($form_state['values']['envoi'] != '0' && $form_state['values']['envoi'] != '1') {
    form_set_error('envoi', t(@ERR_MODE_ENVOI ) );
  }
  if (!$form_state['values']['destinataire'] && !$form_state['values']['autre_mail']) {
    form_set_error('destinataire', t(@ERR_SLT_CONTACT ) );
  }
}

/**
 * Validation des pièces justificatifs
 */
function dgf_relance_piece_form_specific($form, &$form_state) {
  if ($_FILES['files']['name']['file_to_upload']) {
    $file_name = $_FILES['files']['name']['file_to_upload']; // Nom fichier
    $file_size = $_FILES['files']['size']['file_to_upload']; // Taille du fichier
    
    $max_file_size = 5242880; // Taille Max des fichiers
    // Extension fichier
    $get_file_ext = new SplFileInfo($file_name );
    
    $file_ext = $get_file_ext->getExtension();
    
    $allow_ext = array(
      'pdf',
      'doc',
      'docx',
      'xls',
      'xlsx',
      'jpeg',
      'jpg',
      'png');
    
    // Check file Extension
    if (! in_array(strtolower($file_ext ), $allow_ext )) {
      form_set_error('files[file_to_upload]', t("Votre document " . $file_name . " n'est pas conforme au format suivant : .pdf, .doc, .docx, .xls, .xlsx, .jpeg, .jpg, .png" ) );
    }
    
    // Check file size
    if ($file_size > $max_file_size) {
      form_set_error('files[file_to_upload]', t('Votre document ' . $file_name . ' dépasse les 5 Mo autorisés' ) );
    }
  }
}
