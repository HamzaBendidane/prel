<?php
function export_suivi_demande_data() {
  /** Error reporting */
  error_reporting(E_ALL);
  ini_set('display_errors', TRUE);
  ini_set('display_startup_errors', TRUE);
  date_default_timezone_set('Europe/London');

  require_once libraries_get_path('PHPExcel'). '/Classes/PHPExcel.php';
  $objPHPExcel = new PHPExcel();

  // Set document properties
  $objPHPExcel->getProperties()->setCreator("OPCAIM")
  ->setLastModifiedBy("OPCAIM")
  ->setTitle("Suivi des demandes de gestion et financement")
  ->setSubject("Suivi des demandes de gestion et financement")
  ->setDescription("Suivi des demandes de gestion et financement.")
//   ->setKeywords("office 2007 openxml php")
  ->setCategory("export bdd");

  // TODO : Add data from DB
  $objPHPExcel->setActiveSheetIndex(0)
  ->setCellValue('A1', 'Hello')
  ->setCellValue('B2', 'world!')
  ->setCellValue('C1', 'Hello')
  ->setCellValue('D2', 'world!');

  // Rename worksheet
  $objPHPExcel->getActiveSheet()->setTitle('Suivi des demandes');

  // Set active sheet index to the first sheet, so Excel opens this as the first sheet
//   $objPHPExcel->setActiveSheetIndex(0);

  // Redirect output to a clientâ€™s web browser (Excel5)
  header('Content-Type: application/vnd.ms-excel');
  header('Content-Disposition: attachment;filename="01simple.csv"');
  header('Cache-Control: max-age=0');
  // If you're serving to IE 9, then the following may be needed
  header('Cache-Control: max-age=1');

  // If you're serving to IE over SSL, then the following may be needed
  header ('Expires: Mon, 26 Jul 1997 05:00:00 GMT'); // Date in the past
  header ('Last-Modified: '.gmdate('D, d M Y H:i:s').' GMT'); // always modified
  header ('Cache-Control: cache, must-revalidate'); // HTTP/1.1
  header ('Pragma: public'); // HTTP/1.0

  $objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel5');
  $objWriter->save('php://output');
  exit;

}