<?php
/**
 * Retourne les lignes de texte à affchier dans les blocs couleur.
 * @author Gael GALBAS-FRONTINOIS
 * @param id : id de la catégorie
 * @return count : liste des lignes à afficher
 */
function dashboard_get_texte($id) {
  $lignes = array();


  // TODO : Lecture des dernieres notifications pour la catégorie
  $lignes = array(
      'Information de la demande de création de compte',
      'Validation de la création de l’établissement ',
  );

  return $lignes;
}

/**
 * Retourne les informations relatives à la construction d'un bloc.
 * @author Gael GALBAS-FRONTINOIS
 * @param id : id de la catégorie
 * @return infos : La liste des informations du bloc
 */
function dashboard_get_infos_bloc($id, $user_extranet, $entreprises) {
  switch ($id) {
    case 'saisir_une_demande' :
      $titre = 'Saisir une demande';
      $type = 'blanc';
      $text_haut = 'Je souhaite faire une demande pour...';
      $options_url_contrat_pro = array('query' => drupal_get_query_parameters(array('nature' => '1')));
      $options_url_action_formation= array('query' => drupal_get_query_parameters(array('nature' => '2')));
      $options_url_autre_actions = array('query' => drupal_get_query_parameters(array('nature' => '3')));
      $liste_liens = array(
          'contrat-pro' => array(
              'text' => 'Un contrat de professionnalisation ?',
              'path' => url('dgf/demande', $options_url_contrat_pro),
          ),
          'formation' => array(
              'text' => 'Une action de formation ?',
              'class' => 'grise'
//               'path' => url('dgf/demande', $options_url_action_formation),
          ),
          'autre-prestation' => array(
              'text' => 'Une autre prestation ?',
              'class' => 'grise'
//               'path' => url('dgf/demande', $options_url_autre_actions),
          ),
      );
      break;

    case 'mes_dossiers_en_cours' :
      $titre = 'les demandes en cours';
      $type = 'couleur';
      $image = 'img-dossier';
      
      $couleur_haute = 'VE10';
      $couleur_basse = 'VE11';
      $couleur_plus = 'VE12';
      $categories = array('2');
      $options_url_notif = array(
          'query' => drupal_get_query_parameters(array(
              'ncat' => $categories,
          )));
      $lien = url('/suivi/demande', $options_url_notif);
      break;
     
      
    case 'mon_activité_formation' :
      $titre = 'Mon activité formation';
      $type = 'couleur';
      $image = 'img-croissance';
      // TODO : A brancher sur REPORTING
//       $lien = '/';
//       $couleur_haute = 'JA10';
//       $couleur_basse = 'JA11';
//       $couleur_plus = 'JA12';
      $couleur_haute = 'GR10';
      $couleur_basse = 'GR11';
      $couleur_plus = 'GR12';
      
      break;

    case 'mes_documents' :
      $titre = 'Mes documents';
      $type = 'couleur';
      $image = 'img-agraphe';
      $lien = '/';
      $couleur_haute = 'OR10';
      $couleur_basse = 'OR11';
      $couleur_plus = 'OR12';
      break;

    case 'administration' :
      $titre = 'Administration';
      $type = 'couleur';
      $image = 'img-outils';
      $lien = '/';
      $couleur_haute = 'BF10';
      $couleur_basse = 'BF11';
      $couleur_plus = 'BF12';
      break;

    case 'mes_cotisations_mes_contributions' :
      $titre = 'Mes cotisations / mes contributions';
      $type = 'couleur';
      $image = 'img-document';
      // TODO : A brancher sur COLLECTE
//       $lien = '/';
//       $couleur_haute = 'BC10';
//       $couleur_basse = 'BC11';
//       $couleur_plus = 'BC12';
      $couleur_haute = 'GR10';
      $couleur_basse = 'GR11';
      $couleur_plus = 'GR12';
      break;

    case 'gestion_des_comptes' :
      $titre = 'Gestion des comptes';
      $type = 'blanc';
      $text_haut = 'Gestion des comptes';
      // TODO : utilisateur
      $liste_liens = array(
          'utilisateur' => array(
              'text' => dashboard_db_get_count_users_inactifs_entreprises($entreprises),
              'glyphicons' => 'icon-utilisateur',
              'path' => 'opcaim-admin/utilisateurs',
          ),
          'etablissement' => array(
              'text' => dashboard_db_get_count_entreprises_inactives_entreprises($entreprises),
              'glyphicons' => 'icon-entreprise',
              'path' => 'gestion/etablissement/valider/listes',
          ),
      );
      
      break;

    case 'les_demandes_en_cours' :
      $nature_contrat_pro = array('Contrat de professionnalisation');
      $nature_action_formation = array('Action de formation');
      $nature_contrat_inverse = array('Contrat de professionnalisation', 'Action de formation');
      
      $titre = 'Les demandes en cours';
      $type = 'couleur';
      $image = 'img-dossier';

      $couleur_haute = 'JA10';
      $couleur_basse = 'JA11';
      $couleur_plus = 'JA12';
      $lignes = array(
        'Contrats de professionnalisation +'. dashboard_db_get_count_demande_nature($nature_contrat_pro, $entreprises),
        'Actions de formation +'. dashboard_db_get_count_demande_nature($nature_action_formation, $entreprises),
        'Autres dispositifs +'. dashboard_db_get_count_demanes_nature_autres($nature_contrat_inverse, $entreprises),
      );
      $categories = array('2');
      $options_url_etat = array('query' => drupal_get_query_parameters(array(
          'statut' => '1',
          'ncat' => $categories,
      )));
      $lien = url('suivi/demande', $options_url_etat);
      break;

    case 'suivi_des_dossiers' :
      $nature_contrat_pro = array('Contrat de professionnalisation');
      $nature_action_formation = array('Action de formation');
      $nature_contrat_inverse = array('Contrat de professionnalisation', 'Action de formation');
      
      $titre = 'Suivi des dossiers';
      $type = 'blanc';
      $text_haut = 'Suivi des dossiers';
      $image = 'img-dossier';
      $options_url_etat = array('query' => drupal_get_query_parameters(array('statut' => '2')));
      
      $liste_liens = array(
          'contrat-pro' => array(
              'text' => 'Contrats de professionnalisation '. dashboard_db_get_count_dossier_nature($nature_contrat_pro, $entreprises),
              'path' => url('suivi/demande', $options_url_etat),
              'glyphicons' => 'glyphicon glyphicon-file',
          ),
          'Action de formation' => array(
              'text' => 'Actions de formation ' . dashboard_db_get_count_dossier_nature($nature_action_formation, $entreprises),
              'path' => url('suivi/demande', $options_url_etat),
              'glyphicons' => 'glyphicon glyphicon-file',
          ),
          'Autres dispositifs' => array(
              'text' => 'Autres dispositifs ' . dashboard_db_get_count_dossier_nature_autres($nature_contrat_inverse, $entreprises),
              'path' => url('suivi/demande', $options_url_etat),
              'glyphicons' => 'glyphicon glyphicon-file',
          ),
      );
      break;

    case 'la_collecte' :
      $titre = 'La collecte';
      $type = 'couleur';
      $image = 'img-document';
      // TODO : A brancher sur COLLECTE
      //       $lien = '/';
      //       $couleur_haute = 'BC10';
      //       $couleur_basse = 'BC11';
      //       $couleur_plus = 'BC12';
      $couleur_haute = 'GR10';
      $couleur_basse = 'GR11';
      $couleur_plus = 'GR12';
      break;

    case 'les_dossiers_en_cours' :
      $titre = 'Les dossiers en cours';
      $type = 'couleur';
      $image = 'img-dossier';
      $couleur_haute = 'BC10';
      $couleur_basse = 'BC11';
      $couleur_plus = 'BC12';
      $categories = array('2');
      $options_url_etat = array('query' => drupal_get_query_parameters(array(
          'statut' => '2',
          'ncat' => $categories,
      )));
      $lien = url('suivi/demande', $options_url_etat);
      break;

    case 'suivi_de_l_activité_extranet' :
      $titre = 'Suivi de l’activité extranet';
      $type = 'couleur';
      $image = 'img-outils';
      // TODO : A brancher sur Suivi consolidé de l’activité extranet au niveau national
//       $lien = '/';
//       $couleur_haute = 'VE10';
//       $couleur_basse = 'VE11';
//       $couleur_plus = 'VE12';
      $couleur_haute = 'GR10';
      $couleur_basse = 'GR11';
      $couleur_plus = 'GR12';
      break;

    case 'collecte_contributions' :
      $titre = 'Collecte/Contributions';
      $type = 'couleur';
      $image = 'img-document';
      // TODO : A brancher sur la collecte
//       $lien = '/';
//       $couleur_haute = 'JA10';
//       $couleur_basse = 'JA11';
//       $couleur_plus = 'JA12';
      $couleur_haute = 'GR10';
      $couleur_basse = 'GR11';
      $couleur_plus = 'GR12';
      break;

    case 'les_demandes_en_attentes_d_accord' :
      $titre = 'Les demandes en attentes d’accord';
      $type = 'couleur';
      $image = 'img-dossier';
      $lien = 'suivi/demande';
      $couleur_haute = 'OR10';
      $couleur_basse = 'OR11';
      $couleur_plus = 'OR12';
      break;

    case 'les_actions_en_cours_avec_paiement_opca_paiement_entreprise' :
      $titre = 'Les actions en cours avec paiement';
      $type = 'blanc';
      $text_haut = 'Les actions en cours avec paiement';
      $options_url_paiement_OPCA = array('query' => drupal_get_query_parameters(array('paiement-direct' => '1')));
      $options_url_paiement_entreprise = array('query' => drupal_get_query_parameters(array('paiement-direct' => '0')));
      $liste_liens = array(
          'paiement-OPCA' => array(
              'text' => 'avec paiement OPCA',
//               'class' => 'grise'
              'path' => url('suivi/demande', $options_url_paiement_OPCA),
          ),
          'paiement-entreprise' => array(
              'text' => 'avec paiement entreprise',
//               'class' => 'grise'
              'path' => url('suivi/demande', $options_url_paiement_entreprise),
          ),
      );
      break;

    case 'mes_demandes_et_dossiers' :
      $titre = 'Mes demandes et dossiers';
      $type = 'couleur';
      $image = 'img-dossier';
      $couleur_haute = 'BC10';
      $couleur_basse = 'BC11';
      $couleur_plus = 'BC12';
      $categories = array('2');
      $options_url_etat = array('query' => drupal_get_query_parameters(array(
          'ncat' => $categories,
      )));
      $lien = url('suivi/demande', $options_url_etat);
      break;
  }
  
  $nb_notifications = 0;
  $msg_notifications = array();
  $text_notification = '';
  if($type == 'couleur') {
    if(isset($categories)) {
      $nb_notifications = shared_db_get_count_notifications_categories($categories, $user_extranet);
      $msg_notifications = shared_get_message_categorie($categories, $user_extranet);
      foreach ($msg_notifications as $msg) {
        $text_notification .= '<div>'. $msg . '</div>';
      }
    }
  }

  
  if(!isset($lignes)) {
    $lignes = dashboard_get_texte($id);
  }
  $infos = array(
      'name' => drupal_html_class($id),
      'titre' => isset($titre) ? $titre : '',
      'type' => isset($type) ? $type : '',
      'image' => isset($image) ? $image : '',
      'lien' => isset($lien) ? $lien : '',
      'class' => $type .' '. drupal_html_class($id),
      'nb_notifications' => isset($nb_notifications) ? $nb_notifications : '',
      'lignes' => $lignes,
      'couleur_haute' => isset($couleur_haute) ? $couleur_haute : '',
      'couleur_basse' => isset($couleur_basse) ? $couleur_basse : '',
      'couleur_plus' => isset($couleur_plus) ? $couleur_plus : '',
      'text_haut' => isset($text_haut) ? $text_haut : '',
      'liste_liens' => isset($liste_liens) ? $liste_liens : array(),
      'text_notifications' => isset($text_notification) ? $text_notification : '',
  );

  return $infos;
}

